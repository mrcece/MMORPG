# 一.概述

- 本文档描述副本中对象/飞弹的位移/轨迹的物理公式
- 以3维空间的一个点(x,y,z)代表对象/飞弹的位置,单位米(m)

# 二.对象位移

## 1.移动(走,跑)

- 做匀速直线运动
- 当前坐标是pos(x,y,z)
- 移动方向是dir(x,y,z)
  - 移动方向和面向可能不同!
  - dir.y==0,且单位化
- 移动速度vel(x,y,z)=dir*velNum
  - velNum(移动速度)读CharAbility表WalkSpeedFB/WalkSpeedLR/RunSpeed字段(根据不同状态)
  - 移动速度会受到buff的影响
- 移动距离dis(x,y,z)=vel*dTime
  - dTime是移动时间,注意和velNum单位要匹配!
- 新坐标pos=pos+dis

## 2.skill和受击

- skill和受击状态中的位移采用(t0,t1,x,y,z)的格式
- t0是位移开始的时间点(ms),一般为相对于攻击/受击开始的时间偏移
- t1是位移结束的时间点(ms),一般为相对于攻击/受击开始的时间偏移
- x,y,z为在指定时间段[t0,t1]内,向skill/受击方向,做匀速支线运动,位移总长度为(x,y,z),单位米(m)
- skill的位移读SkillTemplate表AtkPreShift/AtkPreBackUpShift/AtkActShift/AtkBackUpShift/AtkEndShift/AtkEndBackUpShift字段
- 受击的位移读SkillOnHit表HitLightMove/HitBackMove/HitDownMove/HitFlyMove/HitParryMove字段

## 3.空中下落

- 当对象在空中时(击飞),需要做自由落体处理,合成原位移,做复合运动
- 自由落体只会影响y坐标,公式:`y=-G*t*t/2`
- G(重力加速度)读GlobalConfiguration表Gravity字段,单位m/s^2
- 自由落体不会影响原位移的速度!

## 4.阻挡&侧滑

- 如果位移过程中和场景/其他对象发生"穿插",需要做阻挡/侧滑/穿透处理
- 详细参考<<阻挡规则.md>>

# 三.飞弹轨迹

- 飞弹轨迹采用贝塞尔曲线(Bézier)实现
- 曲线参数读FlyBomb表StartPoint/EndPoint/CtrlPoints/CtrlPointOffsets字段