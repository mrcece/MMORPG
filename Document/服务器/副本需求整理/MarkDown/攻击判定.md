# 一.概述

- 游戏中用立方体Box的相交检测来判定攻击命中
- Box是OBB,可以平移,可以旋转
- Box分为攻击Box和受击Box
- 每个对象有一个受击Box,跟随对象移动
- 对象释放skill/飞弹时,创建攻击Box,skill结束/飞弹销毁后,删除攻击Box
- 己方对象的攻击Box与敌方对象的受击Box相交,判定攻击命中
- 对于同一个受击Box,和同一个攻击Box,最多只能命中一次!

# 二.受击Box

- PC       读取Role表Offset,Size,Scale字段
- NPC    读取NpcBasic表Offset,Size,Scale字段
  - Offset是Box中心点相对于对象中心点(碰撞用胶囊体中心点)的偏移
  - Size是Box的大小
  - Scale是Box的缩放
- 受击Box会跟随对象移动,转向
- 对象缩放时,受击Box要跟着缩放!

# 三.攻击Box

- skill攻击Box     读取SkillCollision表Offset,Size,RotateHor,RotateVer字段
  - Offset是Box,在对象面向方向上,相对于对象中心点(碰撞用胶囊体中心点)的偏移
  - Size是Box的大小
  - RotateHor是Box水平旋转速度,绕Box本体的y轴顺时针旋转(y+到y-视角)
  - RotateVer是Box竖直旋转速度,绕Box本体的x轴顺时针旋转(x+到x-视角)
  - 攻击Box可配置跟随/不跟随对象移动/转向
    - 如果跟随,需要根据对象位置/面向,重新计算Box相对于对象的偏移/初始角度
- 飞弹攻击Box    读取FlyBomb表Size字段
  - Size是Box的大小
  - Box需要跟随飞弹轨迹移动位置,改变朝向(x+和轨迹切线方向一致?)
- 对象缩放后,攻击Box,飞弹Box需要缩放吗?

# 四.多碰撞检测

- 同一个攻击Box对同一个受击Box最多计算一次碰撞,如果需要计算多次碰撞,需要创建多个攻击Box
- 为了减少攻击Box的数量,增加多碰撞检测,让同一个攻击Box可以对同一个受击Box产生多次碰撞
- 多碰撞参数读SkillCollision表Availability,Interval参数
  - Availability定义多碰撞的最大次数
  - Interval定义检测间隔时间
  - 将攻击Box持续时间LifeTime均分成Availability个检测时间段,相邻2个检测时间段间隔Interval
  - 当前时间处于检测时间段内,则攻击Box有效
  - 不同检测时间段内的碰撞算不同碰撞